<div class="container-fluid">
    <div class="row min-vh-100">

        <aside class="col-12 col-md-3 col-lg-2 border-end bg-light p-0">
            <app-nav />
        </aside>

        <main class="col-12 col-md-9 col-lg-10 px-3 px-lg-4 py-4">
            <div class="d-flex flex-wrap align-items-center justify-content-between mb-4">
                <div>
                    <!-- Verifica si existen datos -->
                    <div *ngIf="data">

                        <!-- Encabezado -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body d-flex flex-wrap justify-content-between align-items-start gap-3">
                                <div class="me-3">
                                    <!-- Obtiene el nombre y numero de cliente-->
                                    <h3 class="mb-1">{{ data.cliente?.nombre }}</h3>
                                    <div class="text-muted">Cliente: <strong>{{ data.cliente?.cliente }}</strong></div>

                                    <div class="mt-3 d-flex flex-wrap gap-2">
                                        <!-- colocamos plan, clasificacion y plan en el encabezado 
                                         Valida que todo exista-->
                                        <span class="badge bg-primary">{{ data.cliente?.nombrePlan }}</span>
                                        <span class="badge bg-info text-dark" *ngIf="data.cliente?.clasificacion">
                                            {{ data.cliente?.clasificacion }} ‚Ä¢ {{ data.cliente?.desClasificacion }}
                                        </span>
                                        <span class="badge bg-secondary" *ngIf="data.cliente?.planInternet">
                                            {{ data.cliente?.planInternet }}
                                        </span>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <div class="medium text-muted">Deuda actual</div>
                                    <div class="fs-4">
                                        <!-- si existe deuda colo el span colo rojo sino hay deuda color verde
                                         currency formatea el valor a MX$100-->
                                        <span
                                            [class]="(data.cliente?.deuda ?? 0) > 0 ? 'badge bg-danger' : 'badge bg-success'">
                                            {{ (data.cliente?.deuda || 0) | currency:'MXN':'symbol':'1.0-0' }}
                                        </span>
                                    </div>
                                    <!-- Coloca un boton de pagar si hay deuda sino lo omite-->
                                    <button class="btn btn-success btn-sm mt-2" *ngIf="(data.cliente?.deuda ?? 0) > 0">
                                        Pagar ahora
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- tarjeta -->
                        <div class="row g-3">

                            <!-- Direcci√≥n y contacto -->
                            <div class="col-12 col-lg-6">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-header bg-white">
                                        <strong>üìç Direcci√≥n & contacto</strong>
                                    </div>
                                    <!-- Concatena los valores de la direccion 
                                     (direccion + colonia + municipio + estado + pais)-->
                                    <div class="card-body">
                                        <div class="mb-2">
                                            <div class="fw-semibold">Direcci√≥n</div>
                                            <div class="text-muted">
                                                {{ data.cliente?.direccion }}<br>
                                                {{ data.cliente?.colonia }}, {{ data.cliente?.municipio }}, {{
                                                data.cliente?.estado }}<br>
                                                {{ data.cliente?.pais }}
                                            </div>
                                        </div>
                                            <!-- Verifica los valores sino existen coloca un '-' -->
                                        <div class="mb-2">
                                            <div class="fw-semibold">Correo</div>
                                            <div class="text-muted">
                                                {{ data.cliente?.correo || '‚Äî' }}
                                            </div>
                                        </div>

                                        <div>
                                            <div class="fw-semibold">Tel√©fono</div>
                                            <div class="text-muted">
                                                {{ data.cliente?.telefono || '‚Äî' }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Servicios contratados -->
                            <div class="col-12 col-lg-6">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-header bg-white">
                                        <strong>üß© Servicios</strong>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center g-3">
                                            <div class="col-6">
                                                <div class="border rounded-3 p-3 h-100">
                                                    <div class="medium text-muted">Internet</div>
                                                    <!--currency:'MXN':'symbol':'1.0-0' = $50 (formatea el texto)-->
                                                    <div class="fs-5 fw-semibold">
                                                        {{ (data.servicios?.internet?.precio || 0) |
                                                        currency:'MXN':'symbol':'1.0-0' }}/mes
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="border rounded-3 p-3 h-100">
                                                    <div class="medium text-muted">C√°maras</div>
                                                    <div class="fs-5 fw-semibold">
                                                        {{ data.servicios?.camaras?.canServicios || 0 }} servicio(s)
                                                    </div>
                                                    <!-- Si existe el valor 
                                                     currency:'MXN':'symbol':'1.0-0' = $50 (formatea el texto)-->
                                                    <div class="text-muted">
                                                        {{ (data.servicios?.camaras?.precio || 0) |
                                                        currency:'MXN':'symbol':'1.0-0' }}/mes
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <hr class="my-3">
                                        <!-- Router ocupado -->
                                        <div class="d-flex flex-wrap gap-2">
                                            <span class="badge bg-light text-dark border">Router: {{
                                                data.cliente?.router }}</span>
                                            <!-- Nodo ocupado -->
                                            <span class="badge bg-light text-dark border"
                                                *ngIf="data.cliente?.infoRed?.router">
                                                Nodo: {{ data.cliente?.infoRed?.router }}
                                            </span>
                                            <!-- Si es Activo verde sino en gris-->
                                            <span class="badge"
                                                [class.bg-success]="data.cliente?.infoRed?.estado === 'Activo'"
                                                [class.bg-secondary]="data.cliente?.infoRed?.estado !== 'Activo'">
                                                Red: {{ data.cliente?.infoRed?.estado || '‚Äî' }}
                                            </span>
                                            <!-- Si es bound verde, down en rojo y cualqueir otra cosa gris-->
                                            <span class="badge"
                                                [class.bg-success]="data.cliente?.infoRed?.estadoFibra === 'bound'"
                                                [class.bg-warning]="data.cliente?.infoRed?.estadoFibra === 'down'"
                                                [class.bg-secondary]="!data.cliente?.infoRed?.estadoFibra">
                                                Fibra: {{ data.cliente?.infoRed?.estadoFibra || '‚Äî' }}
                                            </span>
                                            <!-- Si existe Ip la coloca-->
                                            <span class="badge bg-light text-dark border"
                                                *ngIf="data.cliente?.infoRed?.address">
                                                IP: {{ data.cliente?.infoRed?.address }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Estado de cuenta -->
                            <div class="col-12">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                        <strong>üí≥ Estado de cuenta</strong>
                                        <span class="small text-muted">Pendiente total: {{ (data.cliente?.deuda || 0) |
                                            currency:'MXN':'symbol':'1.0-0' }}</span>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 120px;">Venta</th>
                                                        <th style="width: 140px;">Emisi√≥n</th>
                                                        <th>Mensualidad</th>
                                                        <th class="text-end" style="width: 160px;">Importe</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let item of data.servicios?.estadoCuenta">
                                                        <td><code>{{ item?.VENTA }}</code></td>
                                                        <!-- Ojo: el backend manda dd-mm-aaaa como string; lo mostramos tal cual -->
                                                        <td>{{ item?.fechaEmision }}</td>
                                                        <td>{{ item?.mensualidad }}</td>
                                                        <td class="text-end fw-semibold">
                                                            {{ item?.importe || 0 | currency:'MXN':'symbol':'1.0-0' }}
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="!data.servicios?.estadoCuenta?.length">
                                                        <td colspan="4" class="text-center text-muted py-4">Sin
                                                            movimientos</td>
                                                    </tr>
                                                </tbody>
                                                <tfoot class="table-light">
                                                    <tr>
                                                        <th colspan="3" class="text-end">Total pendiente</th>
                                                        <th class="text-end">
                                                            {{ data.cliente?.deuda || 0 |
                                                            currency:'MXN':'symbol':'1.0-0' }}
                                                        </th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>                                    
                                    <!--<div class="card-footer bg-white small text-muted">
                                        Los importes se muestran en MXN.
                                    </div>-->                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>