<div class="container services-container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="fw-bold mb-0">Mis servicios</h3>
    </div>
  </div>

  <!-- Formulario agregar servicio -->
  <div class="card shadow-sm mb-4 border-0">
    <div class="card-body">
      <form (ngSubmit)="service()" [formGroup]="serviceForm">
        <label class="form-label fw-semibold mb-2">Agregar nuevo servicio</label>

        <div class="input-group">
          <span class="input-group-text bg-light">
            <i class="bi bi-hash"></i>
          </span>

          <input type="text" class="form-control" placeholder="Número de cliente" formControlName="numero_cliente"
            [class.is-invalid]="numero_cliente.invalid && (numero_cliente.dirty || numero_cliente.touched)" />

          <button class="btn btn-primary px-4" type="submit" [disabled]="adding || serviceForm.invalid">
            <span *ngIf="adding" class="spinner-border spinner-border-sm me-2" role="status"></span>
            Agregar
          </button>
        </div>

        <div *ngIf="numero_cliente.invalid && (numero_cliente.dirty || numero_cliente.touched)"
          class="invalid-feedback d-block mt-1">
          <div *ngIf="numero_cliente.errors?.['required']">
            El número de cliente es obligatorio.
          </div>
          <div *ngIf="numero_cliente.errors?.['maxlength']">
            Número demasiado largo.
          </div>
          <div *ngIf="numero_cliente.errors?.['pattern']">
            Formato inválido. Use el formato 00XXXXXX-X.
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width:3rem;height:3rem;"></div>
    <p class="mt-3 text-muted">Cargando servicios...</p>
  </div>

  <!-- Cards -->
  <div *ngIf="!loading" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div *ngFor="let s of servicios" class="col">
      <div class="card service-card h-100 border-0 shadow-sm">

        <div class="card-body d-flex flex-column">

          <!-- Header -->
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="fw-bold mb-0"># {{ s.numero_cliente }}</h5>

            </div>

            <!-- CARDS -->
            <span class="badge status-badge" [ngClass]="{
              'bg-success': cliente[s.id]?.cliente?.infoRed?.estado?.toLowerCase() === 'activo',
              'bg-danger': cliente[s.id]?.cliente?.infoRed?.estado?.toLowerCase() === 'suspendido',
              'bg-secondary': !cliente[s.id]?.cliente?.infoRed?.estado
            }">
              {{ cliente[s.id]?.cliente?.infoRed?.estado || 'CANCELADO' }}
            </span>
          </div>

          <!--  -->
          <div class="mb-3">
            <span class="me-2">
              <small class="text-muted" style="font-size: 0.7em;">{{cliente[s.id]?.cliente?.colonia}}</small>
            </span>
          </div>

          <!-- Acciones -->
          <div class="mt-auto d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm flex-fill" (click)="verDetalles(s.numero_cliente)">
              <i class="bi bi-eye me-1"></i>
              Ver detalles
            </button>

            <button class="btn btn-outline-danger btn-sm" (click)="eliminarServicio(s.id)">
              <i class="bi bi-trash">Eliminar</i>
            </button>
          </div>

        </div>
      </div>
    </div>

    <ngx-sonner-toaster richColors position="top-center"></ngx-sonner-toaster>
  </div>

</div>